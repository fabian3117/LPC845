/*******************************************************************************************************************************//**
 *
 * @file		inputs.cpp
 * @brief		Descripcion del modulo
 * @date		10 ago. 2022
 * @author		Ing. Marcelo Trujillo
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "inputs.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** IMPLEMENTACION DE LOS METODODS DE LA CLASE
 **********************************************************************************************************************************/
//gpio ( uint8_t puerto , uint8_t bit , uint8_t modo , uint8_t direccion , uint8_t actividad );

inputs::inputs(uint8_t puerto , uint8_t bit , uint8_t modo , uint8_t actividad , uint8_t MaxRebotes ):
gpio( puerto , bit , modo , gpio::input ,  actividad )
{
	m_ticks = MAX_TICKS;
	m_BufferEntrada = 0;
	m_contador = 0;
	m_MaxRebotes = MaxRebotes;
	g_swhandler.push_back(this);
}

inputs::~inputs() {
	// TODO Auto-generated destructor stub
}

 void inputs::SWhandler(void)
 {
	 uint8_t cambio;

	 m_ticks --;
	 if ( !m_ticks )
	 {
		 m_ticks = MAX_TICKS;
		 cambio = m_BufferEntrada ^ GetPin();

		 if ( cambio )
		 {
			 m_contador++;
			 if( m_contador >= m_MaxRebotes )
			 {
				 m_BufferEntrada = !m_BufferEntrada ;
				 m_contador = 0;
			 }
		 }
		 else
			 m_contador = 0;

	 }
 }

 void inputs::Inicializar ( void )
 {
	 SetDir();
	 SetPinResistor();
	 m_BufferEntrada = GetPin();
 }

 uint8_t inputs::Get( void )
 {
	 return m_BufferEntrada;
 }
